<!DOCTYPE html>
<html>
<head>
    <title>Yan's Valentine</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: url('https://images.unsplash.com/photo-1554080352-6b5be5e37bc3?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            overflow: hidden;
            position: relative;
        }

        #canvas {
            margin-top: 20px;
            filter: drop-shadow(0 0 10px rgba(255, 65, 108, 0.3));
        }

        .message {
            font-family: 'Dancing Script', cursive;
            font-size: 3.2em;
            color: #ff69b4;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            opacity: 0;
            margin-top: 30px;
            position: relative;
            z-index: 2;
            animation: fadeInUp 2s ease-out 5s forwards;
            text-align: center;
            line-height: 1.3;
        }

        .message small {
            font-size: 0.5em;
            display: block;
            margin-top: 8px;
            letter-spacing: 1px;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .star {
            position: absolute;
            animation: twinkle 2s infinite;
            opacity: 0;
            font-size: 22px;
            pointer-events: none;
        }

        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0) rotate(0deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(180deg); }
            100% { opacity: 0; transform: scale(0) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <canvas id="canvas"></canvas>
    <div class="message">
        Yan, Happy Valentine's Day
        <small>2025.2.14</small>
    </div>

    <script>
        // 生成动态星星
        function createStars() {
            const container = document.querySelector('.stars');
            for (let i = 0; i < 40; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.cssText = `
                    left: ${Math.random() * 100}%;
                    top: ${Math.random() * 100}%;
                    color: ${Math.random() > 0.5 ? '#FFD700' : '#C0C0C0'};
                    animation-delay: ${Math.random() * 2}s;
                `;
                star.innerHTML = Math.random() > 0.5 ? '✦' : '✧';
                container.appendChild(star);
            }
        }
        createStars();

        // 画布初始化
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let animationComplete = false;

        // 响应式设置
        function resizeCanvas() {
            const size = Math.min(window.innerWidth, window.innerHeight) * 0.7;
            canvas.width = size;
            canvas.height = size * 0.95;
            if(animationComplete) drawStaticHeart();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // 生成心形数据
        let particles = [];
        function initHeart() {
            particles = [];
            const pixelSize = canvas.width / 150; // 超细颗粒
            const centerX = canvas.width/2;
            const centerY = canvas.height/2 + canvas.height*0.05;

            for(let x = -100; x <= 100; x++){
                for(let y = -100; y <= 100; y++){
                    // 优化心形方程
                    const xx = x * 0.04;
                    const yy = y * 0.04 - 0.5;
                    if(Math.pow(xx*xx + yy*yy - 1, 3) - xx*xx * yy*yy*yy < 0) {
                        particles.push({
                            x: centerX + x * pixelSize,
                            y: centerY + y * pixelSize,
                            size: pixelSize * (0.9 + Math.random()*0.2)
                        });
                    }
                }
            }
        }
        initHeart();

        // 三色渐变函数
        function getColor(progress) {
            const colors = [
                [148, 0, 211],   // 紫色
                [255, 0, 0],     // 红色
                [255, 192, 203]   // 粉红
            ];
            
            const phase = progress * 2;
            const index = Math.min(Math.floor(phase), colors.length - 2);
            const ratio = phase - index;
            
            return `rgb(
                ${colors[index][0] + (colors[index+1][0] - colors[index][0]) * ratio},
                ${colors[index][1] + (colors[index+1][1] - colors[index][1]) * ratio},
                ${colors[index][2] + (colors[index+1][2] - colors[index][2]) * ratio}
            )`;
        }

        // 绘制静态爱心
        function drawStaticHeart() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            particles.forEach((p, i) => {
                ctx.fillStyle = getColor(i/particles.length);
                ctx.beginPath();
                ctx.roundRect(p.x, p.y, p.size, p.size, 2);
                ctx.fill();
            });
        }

        // 动态构建爱心
        let startTime = null;
        function animateHeart(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = Math.min((timestamp - startTime) / 5000, 1);
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const count = Math.floor(progress * particles.length);
            particles.slice(0, count).forEach((p, i) => {
                ctx.fillStyle = getColor(i/particles.length);
                ctx.beginPath();
                ctx.roundRect(p.x, p.y, p.size, p.size, 2);
                ctx.fill();
            });

            if (progress < 1) {
                requestAnimationFrame(animateHeart);
            } else {
                animationComplete = true;
                drawStaticHeart();
            }
        }

        // 启动动画
        setTimeout(() => {
            initHeart();
            requestAnimationFrame(animateHeart);
        }, 500);
    </script>
</body>
</html>
